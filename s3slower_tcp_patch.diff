--- s3slower.c.orig	2025-08-20 20:00:00.000000000 +0000
+++ s3slower.c	2025-08-20 20:00:00.000000000 +0000
@@ -1,6 +1,7 @@
 #include <uapi/linux/ptrace.h>
 #include <linux/sched.h>
 #include <linux/socket.h>
+#include <net/sock.h>
 
 // Configuration - will be replaced by Python
 #define TARGET_PID 0
@@ -226,3 +227,26 @@
 
     return 0;
 }
+
+// NEW: Support for tcp_sendmsg (used by elbencho/AWS SDK)
+int trace_tcp_sendmsg(struct pt_regs *ctx, struct sock *sk, struct msghdr *msg, size_t size) {
+    u64 pid_tgid = bpf_get_current_pid_tgid();
+    u32 pid = pid_tgid >> 32;
+    
+    // PID filtering
+    if (TARGET_PID != 0 && pid != TARGET_PID) return 0;
+    
+    // Skip small messages
+    if (size < 20) return 0;
+    
+    // Get process name to check if it's a known S3 client
+    char comm[TASK_COMM_LEN] = {};
+    bpf_get_current_comm(&comm, sizeof(comm));
+    u8 client_type = detect_client_type(comm);
+    
+    // Only process known clients
+    if (client_type == CLIENT_UNKNOWN) return 0;
+    
+    // Process as if it was a write syscall with fd=-1 to indicate tcp_sendmsg
+    return handle_write(ctx, pid_tgid, -1, NULL, size, client_type);
+}
